<html>

<body>

  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    let ballX = 50
    let ballY = 50
    let ballSpeedX = 15
    let ballSpeedY = 5
    let canvas;
    let canvasContext;
    const paddleThinkness = 10
    const paddleHeight = 100
    const maxScore = 3
    let playerPaddle1 = 250
    let playerPaddle2 = 250
    let playerPaddle1Score = 0
    let playerPaddle2Score = 0
    let showWinScreen = false

    window.onload = function() {
      canvas = document.getElementById('gameCanvas');
      canvasContext = canvas.getContext('2d');

      var framesPerSecond = 30;
      setInterval(function(){
          moveEverything()
          drawEverything()
          drawBackground()
      }, 1000/framesPerSecond) // 1000 miliseconds

      canvas.addEventListener('mousemove', function(e){
          let mousePos = calcPadlePos(e);
          playerPaddle1 = mousePos.y - paddleHeight/2
      })

      canvas.addEventListener('click', handleMouseClick())

    }

    function handleMouseClick(e){
      console.log('click is here')
      if (showWinScreen){
        showWinScreen = false
      }
    }

    function calcPadlePos(e){
      let rectPos = canvas.getBoundingClientRect();
      let rootPos = document.documentElement;   //html page
      let mouseX = e.clientX - rectPos.left - rootPos.scrollLeft
      let mouseY = e.clientY - rectPos.top - rootPos.scrollTop

      return {
        x: mouseX,
        y: mouseY
      }
    }

    function moveEverything(){
      if (showWinScreen) return

      computerMove()

      ballX += ballSpeedX;
      ballY += ballSpeedY;

      if (ballX < paddleThinkness){
        if (ballY > playerPaddle1 && ballY < playerPaddle1 + paddleHeight){
          ballSpeedX = -ballSpeedX;

          let deltaY = ballY - (playerPaddle1 + paddleHeight/2)
          ballSpeedY = deltaY * 0.35

        } else {
          playerPaddle2Score ++
          ballReset()
        }
      }

      if (ballX > (canvas.width - paddleThinkness)){
        if (ballY > playerPaddle2 && ballY < playerPaddle2 + paddleHeight){
          ballSpeedX = -ballSpeedX;

          let deltaY = ballY - (playerPaddle2 + paddleHeight/2)
          ballSpeedY = deltaY * 0.35

        } else {
          playerPaddle1Score ++
          ballReset()
        }
      }

      if (ballY < 0){
        ballSpeedY = -ballSpeedY;
      }

      if (ballY > canvas.height ){
        ballSpeedY = -ballSpeedY;
      }
    }

    function drawEverything() {

      if (showWinScreen){
        canvasContext.fillStyle = "white"
        canvasContext.fillText("Click to continue", canvas.width/2, canvas.height/2)
        return
      }
      drawRect(0, 0, canvas.width, canvas.height, 'black')
      drawRect(0, playerPaddle1, paddleThinkness, paddleHeight, 'white')
      drawRect((canvas.width-paddleThinkness), playerPaddle2, paddleThinkness, paddleHeight, 'white')
      drawCircle(ballX, ballY, 10);
      canvasContext.fillText('Player 1: ' + playerPaddle1Score, 100, 50)
      canvasContext.fillText('Player 2: ' + playerPaddle2Score, canvas.width - 100, 50)
    }

    function drawCircle(posX, posY, radius){
      canvasContext.fillStyle = 'white';
      canvasContext.beginPath();
      canvasContext.arc(posX, posY, radius, 0, Math.PI*2, true)
      canvasContext.fill()
    }

    function drawRect(leftX, topY, width, height, drawColor){
      canvasContext.fillStyle = drawColor;
      canvasContext.fillRect(leftX, topY, width, height);
    }

    function drawStar(cx, cy, spikes, outerRadius, innerRadius){
        var rot = Math.PI / 2 * 3;
        var x = cx;
        var y = cy;
        var step = Math.PI / spikes;

        canvasContext.strokeSyle = "#000";
        canvasContext.beginPath();
        canvasContext.moveTo(cx, cy - outerRadius)
        for (i = 0; i < spikes; i++) {
            x = cx + Math.cos(rot) * outerRadius;
            y = cy + Math.sin(rot) * outerRadius;
            canvasContext.lineTo(x, y)
            rot += step

            x = cx + Math.cos(rot) * innerRadius;
            y = cy + Math.sin(rot) * innerRadius;
            canvasContext.lineTo(x, y)
            rot += step
        }
        canvasContext.lineTo(cx, cy - outerRadius)
        canvasContext.closePath();
        canvasContext.lineWidth = 5;
        canvasContext.strokeStyle = 'white';
        canvasContext.stroke();
        canvasContext.fillStyle = 'white';
        canvasContext.fill();
    }

    function drawBackground(){
        drawStar(50, 50, 4, 5, 20);
    }

    function ballReset(){

      if (playerPaddle1Score > maxScore || playerPaddle2Score > maxScore){
        playerPaddle1Score = 0
        playerPaddle2Score = 0
        showWinScreen = true
      }
      ballX = canvas.width/2
      ballY = canvas.height/2
    }

    function computerMove(){
      let playerPaddle2Center = playerPaddle2 + paddleHeight/2
      if (playerPaddle2Center < ballY - 35){
        playerPaddle2 += 6
      } else if(playerPaddle2Center < ballY + 35){
        playerPaddle2 -= 6
      }
    }
  </script>
</body>

</html>
